<script>
$(document).ready(
    function () {
        const lastNameField = $('#id_last_name_input');
        const firstNameField = $('#id_first_name_input');

        const customerSelectField = $('select[name="customer_output"]');
        const outputField = $('#id_text_output');

        function fetchData() {
            const lastName = lastNameField.val();
            const firstName = firstNameField.val();

            $.ajax({
                url: '{% url "check_in-partial_form_data" %}',
                type: 'POST',
                data: {
                    'last_name': lastName,
                    'first_name': firstName,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (response) {
                    outputField.val(response.message);
                    customerSelectField.empty();

                    response.customers.forEach((customer) => {
                        const option = $('<option>');
                        option.text(customer.first_name + ' ' + customer.last_name);
                        option.val(customer.first_name + ' ' + customer.last_name);
                        customerSelectField.append(option);
                    });
                },
                error: function (response) {
                    console.error(response.message);
                }
            });
        }

        lastNameField.on('input', fetchData);
        firstNameField.on('input', fetchData);
});
</script>
